(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{5599:function(e,l,t){Promise.resolve().then(t.bind(t,4714))},4714:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return V}});var s=t(7437),n=t(3454),a=t(7689),i=t(9226),r=t(4124),c=t(8569),o=t(4772),d=t(7394),u=t(4052),m=t(471),p=t(6682),x=t(4722),h=t(2265),j=t(1480),f=t(6873),g=t(2521),Z=t(6115),v=t(5057),k=t(3650),b=t(8625);let C={height:22,width:100,marginInlineEnd:8,verticalAlign:"top"};var F=e=>{let{id:l,value:t,onChange:n,color:a}=e,{token:r}=v.Z.useToken(),[c,o]=(0,h.useState)(!1),[d,u]=(0,h.useState)(""),m=(0,h.useRef)(null);(0,h.useEffect)(()=>{if(c){var e;null===(e=m.current)||void 0===e||e.focus()}},[c]);let p=e=>{n(t.filter(l=>l!==e))},x=()=>{d&&!t.includes(d)&&n([...t,d]),o(!1),u("")},j={height:22,background:r.colorBgContainer,borderStyle:"dashed"};return(0,s.jsxs)("div",{id:l,children:[t.map((e,l)=>{let t=e.length>20,n=(0,s.jsx)(k.Z,{color:a,closeIcon:!0,style:{userSelect:"none"},onClose:()=>p(e),children:t?"".concat(e.slice(0,20),"..."):e},l);return t?(0,s.jsx)(b.Z,{title:e,children:n},e):n}),c?(0,s.jsx)(i.default,{ref:m,style:C,value:d,onChange:e=>{u(e.target.value)},onBlur:x,onPressEnter:x}):(0,s.jsx)(k.Z,{style:j,icon:(0,s.jsx)(Z.Z,{}),onClick:()=>{o(!0)},children:"\xa0\xa0\xa0"})]})},I=t(7326),S=t.n(I);let y={type:"telnet",host:"",port:"23",username:"",password:"",charset:"utf-8",timeoutMilliSeconds:"5000",keepActiveInterval:"60000",keepActiveCommand:" ",keepActiveWaitTimeout:"2000",keepActiveWaitStr:"(!@#$%)",successFlags:[],failFlags:[],keepActiveEnable:!0},A={id:-1,command:"",timeoutMilliSeconds:"5000",successFlags:[],failFlags:[],enter:"\n"},w=e=>{let{form:l,open:t}=e,s=(0,h.useRef)();(0,h.useEffect)(()=>{s.current=t},[t]);let n=s.current;(0,h.useEffect)(()=>{!t&&n&&l.resetFields()},[l,n,t])},E=e=>{let{open:l,onCancel:t,onOk:c,editingValue:o}=e,[d]=n.Z.useForm();return w({form:d,open:l}),(0,h.useEffect)(()=>{l&&null!=o&&d.setFieldsValue(o)},[d,o,l]),(0,s.jsx)(a.Z,{title:"指令详情",open:l,onOk:()=>{c(d.getFieldsValue())},onCancel:t,children:(0,s.jsxs)(n.Z,{form:d,labelCol:{span:8},wrapperCol:{span:12},initialValues:A,children:[(0,s.jsx)(n.Z.Item,{name:"id",style:{display:"none"},children:(0,s.jsx)(i.default,{})}),(0,s.jsx)(n.Z.Item,{name:"command",label:"命令",children:(0,s.jsx)(i.default,{})}),(0,s.jsx)(n.Z.Item,{name:"timeoutMilliSeconds",label:"超时时间",wrapperCol:{span:6},children:(0,s.jsx)(i.default,{suffix:"毫秒"})}),(0,s.jsx)(n.Z.Item,{name:"successFlags",label:"成功标识",children:(0,s.jsx)(F,{color:"green"})}),(0,s.jsx)(n.Z.Item,{name:"failFlags",label:"失败标识",children:(0,s.jsx)(F,{color:"red"})}),(0,s.jsx)(n.Z.Item,{name:"enter",label:"回车符",wrapperCol:{span:4},children:(0,s.jsx)(r.Z,{showSearch:!0,options:[{value:"\n",label:"\\n"},{value:"\r\n",label:"\\r\\n"}]})})]})})};function M(e){if(0===e.length)return null;let l={},t=l;for(let l=0;l<e.length;l++){let s=e[l];t.command=s.command,s.timeoutMilliSeconds!==A.timeoutMilliSeconds&&(t.timeoutMilliSeconds=s.timeoutMilliSeconds),s.enter!==A.enter&&(t.enter=s.enter),s.successFlags.length>0&&(t.successFlags=s.successFlags),s.failFlags.length>0&&(t.failFlags=s.failFlags),l+1<e.length&&(t.next={},t=t.next)}return l}function P(e){if(!e instanceof Object)return[];let l=[],t=0;for(;;){let s={...A,command:e.command};if(e.enter&&(s.enter=e.enter),e.timeoutMilliSeconds&&(s.timeoutMilliSeconds=e.timeoutMilliSeconds),e.successFlags&&e.successFlags.length>0&&(s.successFlags=e.successFlags),e.failFlags&&e.failFlags.length>0&&(s.failFlags=e.failFlags),s.id=t++,l.push(s),e.next)e=e.next;else break}return l}var V=function(){let{TextArea:e}=i.default,[l]=n.Z.useForm(),[t,a]=(0,h.useState)([]),[v,k]=(0,h.useState)(!1),[b,C]=(0,h.useState)([]),[I,A]=(0,h.useState)(!1),[w,V]=(0,h.useState)(null),[W,N]=(0,h.useState)([]),[O,T]=(0,h.useState)(""),[R,_]=c.ZP.useMessage(),L=e=>{a(t.filter(l=>l.id!==e.id))},z=e=>{C(b.filter(l=>l.id!==e.id))},B=(e,l,t)=>{let s=[...W],n=s.filter(l=>l.id===e)[0];n.key=l,n.value=t,N(s)},$=e=>{N(W.filter(l=>l.id!==e.id))};return(0,s.jsxs)(d.Z,{wrap:"wrap",gap:"middle",vertical:!1,children:[_,(0,s.jsxs)("div",{style:{width:"47%"},children:[(0,s.jsxs)(n.Z,{name:"basic",form:l,labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:600},initialValues:y,children:[(0,s.jsx)(n.Z.Item,{label:"类型",name:"type",children:(0,s.jsx)(u.ZP.Group,{children:(0,s.jsxs)(m.Z,{children:[(0,s.jsx)(u.ZP,{value:"telnet",children:"telnet"}),(0,s.jsx)(u.ZP,{value:"ssh",children:"ssh"}),(0,s.jsx)(u.ZP,{value:"shell",children:"shell"})]})})}),(0,s.jsx)(n.Z.Item,{noStyle:!0,dependencies:["type"],children:()=>("ssh"===l.getFieldValue("type")||"telnet"===l.getFieldValue("type"))&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z.Item,{label:"IP",name:"host",wrapperCol:{span:8},children:(0,s.jsx)(i.default,{})}),(0,s.jsx)(n.Z.Item,{label:"端口",name:"port",wrapperCol:{span:3},children:(0,s.jsx)(i.default,{})})]})}),(0,s.jsx)(n.Z.Item,{noStyle:!0,dependencies:["type"],children:()=>"ssh"===l.getFieldValue("type")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z.Item,{label:"用户名",name:"username",wrapperCol:{span:6},children:(0,s.jsx)(i.default,{})}),(0,s.jsx)(n.Z.Item,{label:"密码",name:"password",wrapperCol:{span:6},children:(0,s.jsx)(i.default,{})})]})}),(0,s.jsx)(n.Z.Item,{label:"编码",name:"charset",wrapperCol:{span:3},children:(0,s.jsx)(r.Z,{showSearch:!0,options:[{value:"utf-8",label:"utf-8"},{value:"gbk",label:"gbk"}]})}),(0,s.jsxs)(n.Z.Item,{label:"连接后命令",children:[t.length>0&&(0,s.jsx)(o.Z,{size:"small",bordered:!0,dataSource:t,renderItem:e=>(0,s.jsx)(o.Z.Item,{actions:[(0,s.jsx)(j.Z,{onClick:()=>{V(e),k(!0)}},e.id),(0,s.jsx)(f.Z,{className:"dynamic-delete-button",onClick:()=>L(e)},e.id)],children:e.command})}),(0,s.jsx)(p.ZP,{icon:(0,s.jsx)(Z.Z,{}),onClick:()=>{V(null),k(!0)}})]}),(0,s.jsxs)(n.Z.Item,{label:"登出前命令",children:[b.length>0&&(0,s.jsx)(o.Z,{size:"small",bordered:!0,dataSource:b,renderItem:e=>(0,s.jsx)(o.Z.Item,{actions:[(0,s.jsx)(j.Z,{onClick:()=>{V(e),A(!0)}},e.id),(0,s.jsx)(f.Z,{className:"dynamic-delete-button",onClick:()=>z(e)},e.id)],children:e.command})}),(0,s.jsx)(p.ZP,{icon:(0,s.jsx)(Z.Z,{}),onClick:()=>{V(null),A(!0)}})]}),(0,s.jsx)(n.Z.Item,{name:"successFlags",label:"成功标识",children:(0,s.jsx)(F,{color:"green"})}),(0,s.jsx)(n.Z.Item,{name:"failFlags",label:"失败标识",children:(0,s.jsx)(F,{color:"red"})}),(0,s.jsx)(n.Z.Item,{name:"timeoutMilliSeconds",label:"超时时间",wrapperCol:{span:6},children:(0,s.jsx)(i.default,{suffix:"毫秒"})}),(0,s.jsxs)(n.Z.Item,{label:"扩展属性",children:[W.length>0&&(0,s.jsx)(o.Z,{size:"small",bordered:!0,dataSource:W,renderItem:e=>(0,s.jsxs)(o.Z.Item,{actions:[(0,s.jsx)(f.Z,{className:"dynamic-delete-button",onClick:()=>$(e)},e.id)],children:[(0,s.jsx)(i.default,{defaultValue:e.key,onBlur:l=>{B(e.id,l.target.value,e.value)},style:{width:"30%"}}),(0,s.jsx)(g.Z,{}),(0,s.jsx)(i.default,{defaultValue:e.value,onBlur:l=>{B(e.id,e.key,l.target.value)},style:{width:"auto"}})]})}),(0,s.jsx)(p.ZP,{icon:(0,s.jsx)(Z.Z,{}),onClick:()=>{let e=W.length>0?W[W.length-1].id+1:0;N([...W,{id:e,key:"",value:""}])}})]}),(0,s.jsx)(n.Z.Item,{name:"keepActiveEnable",label:"是否保活",children:(0,s.jsxs)(u.ZP.Group,{children:[(0,s.jsx)(u.ZP,{value:!0,children:"是"}),(0,s.jsx)(u.ZP,{value:!1,children:"否"})]})}),(0,s.jsx)(n.Z.Item,{noStyle:!0,dependencies:["keepActiveEnable"],children:()=>l.getFieldValue("keepActiveEnable")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z.Item,{name:"keepActiveInterval",label:"保活周期",wrapperCol:{span:6},children:(0,s.jsx)(i.default,{prefix:"每",suffix:"毫秒"})}),(0,s.jsx)(x.Z,{message:"注意文本框中包含了默认的保活命令空格字符",type:"info",showIcon:!0,style:{marginLeft:"200px"}}),(0,s.jsx)(n.Z.Item,{label:"保活命令",name:"keepActiveCommand",children:(0,s.jsx)(i.default,{})}),(0,s.jsx)(x.Z,{message:"保活命令结束符可以不在回显中出现，此时保活命令会一直执行到超时",type:"info",showIcon:!0,style:{marginLeft:"200px"}}),(0,s.jsx)(n.Z.Item,{name:"keepActiveWaitStr",label:"保活命令结束符",wrapperCol:{span:6},children:(0,s.jsx)(i.default,{})}),(0,s.jsx)(n.Z.Item,{name:"keepActiveWaitTimeout",label:"保活命令超时时间",wrapperCol:{span:6},children:(0,s.jsx)(i.default,{suffix:"毫秒"})})]})})]}),(0,s.jsx)(E,{open:v,onCancel:()=>k(!1),onOk:e=>{if(-1!==e.id){let l=[...t],s=l.findIndex(l=>l.id===e.id);l[s]=e,a(l)}else e.id=t.length>0?t[t.length-1].id+1:0,a([...t,e]);k(!1)},editingValue:w}),(0,s.jsx)(E,{open:I,onCancel:()=>A(!1),onOk:e=>{if(-1!==e.id){let l=[...b],t=l.findIndex(l=>l.id===e.id);l[t]=e,C(l)}else e.id=b.length>0?b[b.length-1].id+1:0,C([...b,e]);A(!1)},editingValue:w})]}),(0,s.jsxs)("div",{style:{width:"5%"},children:[(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(p.ZP,{onClick:()=>{let e={},s=l.getFieldsValue();e.type=s.type,["host","port","username","password","charset","timeoutMilliSeconds"].forEach(l=>{s[l]&&s[l]!==y[l]&&(e[l]=s[l])}),s.keepActiveEnable?["keepActiveInterval","keepActiveCommand","keepActiveWaitTimeout","keepActiveWaitStr"].forEach(l=>{s[l]!==y[l]&&(e[l]=s[l])}):e.keepActiveCommand="";let n=M(t);null!=n&&(e.postConnect=n);let a=M(b);if(null!=a&&(e.preLogout=a),s.successFlags.length>0&&(e.successFlags=s.successFlags),s.failFlags.length>0&&(e.failFlags=s.failFlags),W.length>0){let l={};W.forEach(e=>l[e.key]=e.value),e.extAttrs=l}let i=S()(e);T(i=function(e,l){for(let t in l){let s=l[t],n=RegExp('"'.concat(s,'": "(.*)"'),"g");e=e.replace(n,'"'.concat(s,'": $1'))}return e}(i,["port","timeoutMilliSeconds","keepActiveInterval","keepActiveWaitTimeout"]))},children:">json"}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(p.ZP,{onClick:()=>{let e=function(e,l){for(let t in l){let s=l[t],n=RegExp('"'.concat(s,'"\\s*:\\s*(\\S+?)\\s*([,}])'),"g");e=e.replace(n,'"'.concat(s,'": "$1"$2'))}return e}(O,["port","timeoutMilliSeconds","keepActiveInterval","keepActiveWaitTimeout"]),t=null;try{t=JSON.parse(e)}catch(e){}if(null==t){R.open({type:"error",content:"非法JSON配置"});return}l.resetFields();let s={type:t.type};if(["host","port","username","password","charset","timeoutMilliSeconds","keepActiveInterval","keepActiveCommand","keepActiveWaitTimeout","keepActiveWaitStr","successFlags","failFlags"].forEach(e=>{t[e]&&t[e]!==y[e]&&(s[e]=t[e])}),t.keepActiveCommand&&""===t.keepActiveCommand&&(s.keepActiveEnable=!1),l.setFieldsValue(s),t.postConnect?a(P(t.postConnect)):a([]),t.preLogout?C(P(t.preLogout)):C([]),t.extAttrs){let e=[],l=0;for(let s in t.extAttrs)e.push({id:l++,key:s,value:t.extAttrs[s]});N(e)}else N([])},children:"<json"})]}),(0,s.jsx)("div",{style:{width:"44%"},children:(0,s.jsx)(e,{autoSize:{minRows:10,maxRows:30},value:O,onChange:e=>T(e.target.value)})})]})}}},function(e){e.O(0,[658,682,307,812,419,953,513,971,23,744],function(){return e(e.s=5599)}),_N_E=e.O()}]);