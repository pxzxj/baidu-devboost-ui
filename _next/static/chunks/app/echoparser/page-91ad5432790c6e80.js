(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{6729:function(e,t,l){Promise.resolve().then(l.bind(l,381))},381:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return F}});var n=l(7437),a=l(7149),r=l(9226),i=l(8569),s=l(4772),d=l(7394),c=l(4110),o=l(3454),u=l(471),h=l(2250),m=l(6682),x=l(9332),f=l(3187),p=l(2265);let g=p.createContext(null),j=e=>{let{index:t,...l}=e,[a]=o.Z.useForm();return(0,n.jsx)(o.Z,{form:a,component:!1,children:(0,n.jsx)(g.Provider,{value:a,children:(0,n.jsx)("tr",{...l})})})},y=e=>{let{title:t,editable:l,children:a,dataIndex:i,record:s,handleSave:d,...c}=e,[h,m]=(0,p.useState)(!1),x=(0,p.useRef)(null),f=(0,p.useContext)(g);(0,p.useEffect)(()=>{if(h){var e;null===(e=x.current)||void 0===e||e.focus()}},[h]);let j=()=>{m(!h),f.setFieldsValue({[i]:s[i]})},y=async()=>{try{let e=await f.validateFields();j(),d({...s,...e})}catch(e){console.log("Save failed:",e)}},v=a;return l&&(v=h?(0,n.jsx)(o.Z.Item,{style:{margin:0},name:i,children:(0,n.jsx)(r.default,{ref:x,onPressEnter:y,onBlur:y})}):(0,n.jsx)(o.Z.Item,{style:{margin:0},name:i,children:(0,n.jsx)("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:j,children:(0,n.jsx)(u.Z,{children:a})})})),(0,n.jsx)("td",{...c,children:v})};var v=e=>{let{dataSource:t,setDataSource:l}=e,[a,r]=(0,p.useState)(2),[s,d]=i.ZP.useMessage(),c=e=>{t.length>1?l(t.filter(t=>t.key!==e)):s.open({type:"warning",content:"至少需要一个字段"})},o=e=>{let n=[...t],i=n.findIndex(t=>e===t.key);n.splice(i+1,0,{key:a,name:""}),l(n),r(a+1)},u=e=>{let n=[...t],a=n.findIndex(t=>e.key===t.key),r=n[a];n.splice(a,1,{...r,...e}),l(n)},h=[{title:"name",dataIndex:"name",width:"30%",editable:!0},{title:"operation",dataIndex:"operation",render:(e,l)=>t.length>=1?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.ZP,{onClick:()=>c(l.key),children:"-"}),(0,n.jsx)(m.ZP,{onClick:()=>o(l.key),children:"+"})]}):null}].map(e=>e.editable?{...e,onCell:t=>({record:t,editable:e.editable,dataIndex:e.dataIndex,title:e.title,handleSave:u})}:e);return(0,n.jsxs)("div",{children:[d,(0,n.jsx)(f.Z,{components:{body:{row:j,cell:y}},rowClassName:()=>"editable-row",bordered:!0,dataSource:t,columns:h,pagination:!1})]})},b=l(1423);let Z=p.createContext(null),k=e=>{let{index:t,...l}=e,[a]=o.Z.useForm();return(0,n.jsx)(o.Z,{form:a,component:!1,children:(0,n.jsx)(Z.Provider,{value:a,children:(0,n.jsx)("tr",{...l})})})},w=e=>{let{title:t,editable:l,children:a,dataIndex:i,record:s,handleSave:d,...c}=e,[h,m]=(0,p.useState)(!1),x=(0,p.useRef)(null),f=(0,p.useContext)(Z);(0,p.useEffect)(()=>{if(h){var e;null===(e=x.current)||void 0===e||e.focus()}},[h]);let g=()=>{m(!h),f.setFieldsValue({[i]:s[i]})},j=async()=>{try{let e=await f.validateFields();g(),d({...s,...e})}catch(e){console.log("Save failed:",e)}},y=a;return l&&(y=h?(0,n.jsx)(o.Z.Item,{style:{margin:0},name:i,children:(0,n.jsx)(r.default,{ref:x,onPressEnter:j,onBlur:j})}):(0,n.jsx)("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:g,children:(0,n.jsx)(u.Z,{children:a})})),(0,n.jsx)("td",{...c,children:y})};var I=e=>{let{dataSource:t,setDataSource:l}=e,[a,r]=(0,p.useState)(2),[s,d]=i.ZP.useMessage(),c=e=>{console.log(t),console.log(e),t.length>1?l(t.filter(t=>t.key!==e)):s.open({type:"warning",content:"至少需要一个字段"})},o=e=>{console.log("count:"+a);let n=[...t],i=n.findIndex(t=>e===t.key);n.splice(i+1,0,{key:a,name:"",matchName:"",valuePattern:"",nullable:!1}),l(n),r(a+1)},u=(e,n)=>{e.nullable=n;let a=[...t],r=a.findIndex(t=>e.key===t.key),i=a[r];a.splice(r,1,{...i,...e}),l(a)},h=e=>{let n=[...t],a=n.findIndex(t=>e.key===t.key),r=n[a];n.splice(a,1,{...r,...e}),l(n)},x=[{title:"matchName",dataIndex:"matchName",editable:!0},{title:"name",dataIndex:"name",editable:!0},{title:"valuePattern",dataIndex:"valuePattern",editable:!0},{title:"nullable",dataIndex:"nullable",render:(e,t)=>(0,n.jsx)(b.Z,{checked:e,onChange:e=>u(t,e)})},{title:"operation",dataIndex:"operation",render:(e,l)=>t.length>=1?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.ZP,{onClick:()=>c(l.key),children:"-"}),(0,n.jsx)(m.ZP,{onClick:()=>o(l.key),children:"+"})]}):null}].map(e=>e.editable?{...e,onCell:t=>({record:t,editable:e.editable,dataIndex:e.dataIndex,title:e.title,handleSave:h})}:e);return(0,n.jsxs)("div",{children:[d,(0,n.jsx)(f.Z,{components:{body:{row:k,cell:w}},rowClassName:()=>"editable-row",bordered:!0,dataSource:t,columns:x,pagination:!1})]})};function P(e){return e.replace("(","\\(").replace(")","\\)")}var S=l(7326),C=l.n(S),N=l(6873);let{TabPane:R}=a.default,_={columns:[{title:"Name",dataIndex:"name"}],data:[{key:"1",name:"Josh Long"}]},E="[|\\s=:]+";var F=function(){let{TextArea:e}=r.default,[t,l]=(0,p.useState)(""),[g,j]=(0,p.useState)("field"),[y,b]=(0,p.useState)(E),[Z,k]=(0,p.useState)(3),[w,S]=(0,p.useState)(3),[F,q]=(0,p.useState)(""),[L,V]=(0,p.useState)([]),[O,z]=(0,p.useState)([{key:"0",name:"",matchName:"",valuePattern:"",nullable:!1}]),[B,M]=(0,p.useState)(""),[D,$]=(0,p.useState)([{key:"0",name:""}]),[A,J]=(0,p.useState)(""),[T,K]=(0,p.useState)(_),[Y,G]=i.ZP.useMessage(),H=(0,p.useRef)(null),Q=e=>{V(L.filter(t=>t!==e))},U=()=>{let t="create table MY_TABLE(\r\n id integer auto_increment primary key,\r\n",l=O;for(let e in"pattern"===g&&(l=D),l)t+=l[e].name+" varchar(200),\r\n";return t+="check_device_id integer,\r\ndevice_id integer,\r\ncollect_finish_time datetime\r\n);\r\n",(0,n.jsx)(e,{value:t,autoSize:{maxRows:15}})};return(0,n.jsxs)(d.Z,{wrap:"wrap",gap:"middle",vertical:!1,children:[G,(0,n.jsx)("div",{style:{width:"100%"},children:(0,n.jsx)(e,{value:t,onChange:e=>l(e.target.value),autoSize:{minRows:10,maxRows:15}})}),(0,n.jsx)(c.Z,{}),(0,n.jsx)("div",{style:{width:"44%"},children:(0,n.jsxs)(a.default,{activeKey:g,onChange:e=>j(e),centered:!0,children:[(0,n.jsx)(R,{tab:"字段型",children:(0,n.jsxs)(o.Z,{name:"fieldForm",labelAlign:"left",children:[(0,n.jsx)(o.Z.Item,{label:"分隔符",name:"delimiter",children:(0,n.jsx)(r.default,{style:{width:"150px"},defaultValue:y,onChange:e=>b(e.target.value)})}),(0,n.jsxs)(u.Z,{style:{display:"flex",marginBottom:8},align:"baseline",children:[(0,n.jsx)(o.Z.Item,{label:"最小行数",children:(0,n.jsx)(h.Z,{style:{width:"50px"},min:1,max:1e3,defaultValue:Z,onChange:e=>k(e)})}),(0,n.jsx)(o.Z.Item,{label:"最小字段数",children:(0,n.jsx)(h.Z,{style:{width:"50px"},min:1,max:1e3,defaultValue:w,onChange:e=>S(e)})}),(0,n.jsx)(o.Z.Item,{children:(0,n.jsx)(m.ZP,{onClick:()=>{let e=function(e,t,l,n){let a=e.replace(/\r\n/g,"\n").split("\n").map(e=>e.trim()).filter(e=>e.length>0),r=function(e,t,l,n){let a=-1,r=[],i=0;for(let s of e){let e=s.split(t);if(e.length===a){if(++i>=l)break}else e.length>=n?(a=e.length,r=e):a=-1,i=0}return i>=l?r:[]}(a,t,l,n);return 0===r.length&&(r=function(e,t,l){let n=0,a=[];for(let r in e){let i=e[r].split(t);if(2===i.length)n++,a.push(i[0]);else{if(n>=l)break;n=0,a=[]}}return n>=l?a:[]}(a,t,n)),r}(t,new RegExp(y),Z,w);if(e.length>0){let t=[];for(let l in e){let n=e[l];t.push({key:"k".concat(l),name:n,matchName:n,valuePattern:"",nullable:!1})}z(t)}else Y.info("没有识别到字段")},children:"自动识别"})})]}),(0,n.jsxs)(o.Z.Item,{children:[(0,n.jsx)(r.default,{style:{width:"200px"},value:F,onChange:e=>q(e.target.value)})," ",(0,n.jsx)(m.ZP,{onClick:()=>{if(""!==F&&-1===L.indexOf(F)){let e=[...L];e.push(F),V(e),q("")}},children:"忽略行"})]}),L.length>0&&(0,n.jsx)(o.Z.Item,{children:(0,n.jsx)(s.Z,{size:"small",bordered:!0,dataSource:L,renderItem:e=>{let t=L.indexOf(e)+"";return(0,n.jsx)(s.Z.Item,{actions:[(0,n.jsx)(N.Z,{className:"dynamic-delete-button",onClick:()=>Q(e)},t)],children:e})}})}),(0,n.jsx)(o.Z.Item,{children:(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(m.ZP,{type:"primary",onClick:()=>{if(1===O.length&&""===O[0].matchName){Y.info("请先输入解析字段信息");return}let e={};e.delimiter=y,e.ignoreLinePatterns=L;let l=[],n=[{title:"序号",dataIndex:"qwerty_seq"}];for(let e in O){let t=O[e],a={matchName:t.matchName,name:t.name};""!==t.valuePattern&&(a.valuePattern=t.valuePattern),a.nullable=t.nullable,l.push(a),n.push({title:t.name,dataIndex:t.name})}e.fields=l;let a=function(e,t){let l=t.ignoreLinePatterns.map(e=>new RegExp(e)),n=function(e,t){let l=t.delimiter,n=e.split("\n"),a=t.fields,r=a.map(e=>e.matchName).map(P).join(l);r=new RegExp("^".concat(r,"$"));let i=[];if(a.every(e=>e.valuePattern)){let e=a.map((e,t)=>"(".concat(e.valuePattern,")").concat(e.nullable?"?":""));i.push(new RegExp("^".concat(e.join(l),"$")));for(let t=a.length-1;t>0;t--)if(a[t].nullable)i.push(new RegExp("^".concat(e.slice(0,t).join(l),"$")));else break}let s=!1,d=[];for(let e of n)if(r.test(e))s=!0,console.log("匹配到头");else if(s){if(console.log(i),i.length>0){s=!1;for(let t=0;t<i.length;t++){let l=i[t],n=e.match(l);if(n){let e={};for(let l=0;l<a.length;l++)e[a[l].name]=l<a.length-t?n[l+1]:"";d.push(e),s=!0;break}}}else{let t=e.split(new RegExp(l));if(t.length===a.length){let e={};for(let l=0;l<t.length;l++)e[a[l].name]=t[l];d.push(e)}else s=!1}}return d}(e=e.replace("\r\n","\n").split("\n").map(e=>e.trim()).filter(e=>""!==e).filter(e=>!l.some(t=>t.test(e))).join("\n"),t);return 0===n.length&&(n=function(e,t){let l=t.fields,n=e.split("\n"),a=[];for(let e=0;e+l.length-1<n.length;e++){let r=!0,i={};for(let a=0;a<l.length;a++){let s=l[a].name,d=l[a].matchName,c=t.delimiter,o=n[e+a].replace(new RegExp("^".concat(P(d)).concat(c)),"");if(n[e+a]!==o)i[s]=o;else{r=!1;break}}if(r){a.push(i);break}}return a}(e,t)),n}(t,e);for(let e in a)a[e].key=e+"",a[e].qwerty_seq=e+"";K({columns:n,data:a}),H.current&&H.current.scrollIntoView({behavior:"smooth"})},children:"解析"}),(0,n.jsx)(x.Z,{overlayInnerStyle:{width:"400px"},content:U(),title:"Schema",trigger:"click",children:(0,n.jsx)(m.ZP,{children:"建表语句"})})]})}),(0,n.jsx)(o.Z.Item,{children:(0,n.jsx)(I,{dataSource:O,setDataSource:z})})]})},"field"),(0,n.jsx)(R,{tab:"正则型",children:(0,n.jsxs)(o.Z,{name:"patternForm",children:[(0,n.jsx)(o.Z.Item,{label:"正则",name:"pattern",children:(0,n.jsx)(r.default,{value:B,onChange:e=>M(e.target.value)})}),(0,n.jsx)(o.Z.Item,{children:(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(m.ZP,{type:"primary",onClick:()=>{if(""===B){Y.info("正则不能为空");return}if(1===D.length&&""===D[0].name){Y.info("请先输入解析字段信息");return}let e={};e.pattern=B,e.fields=D;let l=function(e,t){let l;let n=[],a=t.fields,r=RegExp(t.pattern,"g");for(;null!==(l=r.exec(e));){let e={};for(let t=0;t<a.length;t++)e[a[t].name]=l[t+1];n.push(e)}return n}(t,e),n=[{title:"序号",dataIndex:"qwerty_seq"}];for(let e in D){let t=D[e];n.push({title:t.name,dataIndex:t.name})}for(let e in l)l[e].key=e+"",l[e].qwerty_seq=e+"";K({columns:n,data:l}),H.current&&H.current.scrollIntoView({behavior:"smooth"})},children:"解析"}),(0,n.jsx)(x.Z,{overlayInnerStyle:{width:"400px"},content:U(),title:"Schema",trigger:"click",children:(0,n.jsx)(m.ZP,{children:"建表语句"})})]})}),(0,n.jsx)(o.Z.Item,{children:(0,n.jsx)(v,{dataSource:D,setDataSource:$})})]})},"pattern")]})}),(0,n.jsxs)("div",{style:{width:"10%"},children:[(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)(m.ZP,{onClick:()=>{let e={};if("field"===g){y!==E&&(e.delimiter=y),L.length>0&&(e.ignoreLinePatterns=L);let t=[];for(let e in O){let l=O[e],n={matchName:l.matchName,name:l.name};""!==l.valuePattern&&(n.valuePattern=l.valuePattern),l.nullable&&(n.nullable=!0),t.push(n)}e.fields=t}else{e.pattern=B;let t=[];for(let e in D)t.push({name:D[e].name});e.fields=t}J(C()(e))},children:">json"}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)(m.ZP,{onClick:()=>{let e=null;try{e=JSON.parse(A)}catch(e){}if(null!=e&&e.fields){if(e.pattern){for(let t in j("pattern"),M(e.pattern),e.fields)e.fields[t].key=t+"";$(e.fields)}else{for(let t in j("field"),e.delimiter?b(e.delimiter):b(E),e.ignoreLinePatterns&&V(e.ignoreLinePatterns),e.fields){let l=e.fields[t];l.key=t+"",l.valuePattern||(l.valuePattern=""),l.nullable||(l.nullable=!1)}z(e.fields)}}else Y.open({type:"error",content:"非法解析配置"})},children:"<json"})]}),(0,n.jsx)("div",{style:{width:"44%"},children:(0,n.jsx)(e,{autoSize:{minRows:10,maxRows:15},value:A,onChange:e=>J(e.target.value)})}),(0,n.jsx)(c.Z,{}),(0,n.jsx)("div",{id:"fieldTableDiv",ref:H,children:(0,n.jsx)(f.Z,{columns:T.columns,dataSource:T.data,pagination:!1})})]})}}},function(e){e.O(0,[658,682,307,812,419,545,306,953,11,971,23,744],function(){return e(e.s=6729)}),_N_E=e.O()}]);